module node_modules

open System
open System.IO

let root = @"D:\Application Data\Visual Studio\Projects\react\react\node_modules\"

let source = @"rxjs\add"

//递归包含所有子目录下的文件，获取全名称的文件列表
//dir路径为绝对路径
//返回的文件也是绝对路径，并且带有扩展名
let rec getfiles dir =
    seq{
        for subdir in Directory.GetDirectories(dir) do


            yield! getfiles subdir

        for file in Directory.GetFiles(dir) do
            yield file
    }

//使用获得的文件名
//生成导入语句
let getImports src =
    Path.Combine(root,src)
    |> getfiles
    |> Seq.map(fun file ->file.Remove(0,root.Length).Replace(@"\","/").Split('.').[0])
    |> Seq.distinct
    |> Seq.map(sprintf "import '%s'")

let exec () =
    let outpath = @"C:\rxjsadd.ts"
    File.WriteAllLines(outpath, getImports source)
    printfn "已经生成文件：'%s'" outpath

